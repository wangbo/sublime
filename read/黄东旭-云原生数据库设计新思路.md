原文地址:[云原生数据库设计新思路](https://mp.weixin.qq.com/s/s6U-HLKNBhcQj9NhKC_a_Q)

# New SQL

## shared nohting流派
* 以google spanner为代表，包括pingcap，cockroachDB
* 优点
	* 无限的水平扩展
	* 强sql支持（不需要指定分片策略，系统自动扩展）
	* 支持事务
	* 跨数据中心的高可用
	* 擅长大数据量，高可用的场景
* 短板
	* 响应速度和性能无法和单机数据库保持一致
* shared nothing如何理解
	* 不同机器，保存的数据不同

# shared everything流派
* 代表产品，AWS auroa，阿里云polorDB
* 基于云原生数据库的核心技术要点
	* 存储和计算分离
	* 相当于mysql跑在云盘上
* 其实就是一个比较好用的云上数据库

# 第四代HTAP数据库
* 标准
	* 支持事务
	* 支持水平扩展，支持高可用
	* 支持SQl
	* 支持实时的数据分析
* 代表产品
	* TiDB 4.0 + TiFlash
	* 主打tp和ap负载在同一个集群，但是之间相互隔离不会影响
* 主要思路
	* 多副本机制，TP一个副本，AP一个副本

# 未来在哪

## snowflake
* 纯粹的存储和计算分离
	* 计算节点是EC2，本地持有缓存
	* 数据主要保存在S3上
* 这不就hadoop那套东西吗

## BigQuery
略

## RockSet
* 基于LSM-Tree的特性设计
	* 越冷的数据越在下层
* Rockset把比较冷的数据放在了s3，热数据放在本地内存或者磁盘

## 作者的总结
* 以上三个系统的特点
	* 分布式
	* 构建在云的标准服务上，基于S3，EBS，作者认为最关键的点S3
	* 充分利用云的弹性

* 作者认为s3是关键的原因
	* 便宜
	* 提供9个9的可用性，这个真的是离谱
	* 可先线性扩展
	* 天然跨云，每一个云上都有S3的对象存储服务。这里有个问题，每一个云指的是啥，是否是不同的云服务商？阿里云也会提供S3存储？

* S3的不足
	* 随机写入的延迟很高，但是吞吐很不错（作者提这个应该是因为TP场景存在大量的随机写入，这么看起来S3其实很适合AP的场景的）

* share nothing vs shared storage(其实就是存储和计算分离)
	* 对于点查询来说，share nothing是存储和计算都是本地，因此最少的话客户端其实是一次rpc就可以完成的
	* 但是shared storage由于存储和计算分离，无论如何都要多一次rpc
	* 作者这么关注这个细节应该是因为还是从TP的角度思考性能的，但是显然对于AP场景来说，存储和计算分离应该是最适合的架构
	* 作者提出的解决方案是《本地缓存+存储和计算分离》，计算节点可以用本地缓存解决，这特么不就是druid吗
* 本地缓存 + 存储和计算分离方案的分析
	* 优点是中和了shared nothing和shared storage的优点
	* 缺点是，本地缓存一旦穿透，延迟会变高，相应的，稳定性就下降了

# 总结
* why存储和计算分离？
	* 作者好像没说为啥要存储和计算分离，只是因为其他牛逼的公司都是这么搞的？？？
	* 只是提了一句，数据迁移比较方便，不需要关系复杂的数据迁移逻辑
		* 这里其实值得深思的点是，doris这种shared nothing的可以和分离的架构做一个对比
		* 目前的balance逻辑其实是耦合了doris自身的逻辑的，以tablet粒度，而不是以文件的粒度
		* 还有colocate join？存储和计算分离架构下，大表的shuffle是不是会被colocate join的场景吊打
	* 总之我觉得这个结论是挺离谱的，感觉作者也是没想明白，就是单纯的想硬往上靠
	* 这个文章比较有价值的观点就是，觉得本地缓存 + 存储和计算分离的架构是可以研究的方向
	* 标题党，真的一点也不新
	* 唯一可能的点就是云原生吧，想要云原生的话，就得结合云上的环境，因此要上云，就得存储和计算分离
* how存储和计算分离？
	* 说了半天不就是druid吗，可以直接开始看druid的论文了
