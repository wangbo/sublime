# 一些参考
[ClickHouse最优实践与原理剖析](https://toutiao.io/posts/yxsih6o/preview)
[](https://developer.jdcloud.com/article/1249)

# 写入

## 写入流程概览

### 分布式表写入主流程
1 对输入数据做分片的拆分
2 一份写本地（如果分片在本机的话）
3 另外两份写本地（如果分片在远程的话），然后批量拷贝到远端

这里写本地的问题在于，本地磁盘IO可能会比较高，写负载比较重，且考虑compaction的话，IO问题会加剧
优化思路也比较简单，在写入数据之前就做数据分片的操作，直接写入数据到不同的分片（这个思路到是和doris比较类似）
然后是用raid加速磁盘写

### 同步写/异步写
同步写是三份都写成功才会返回
异步写是写一份就返回，据说大部分场景都是这样

>一般在使用MergeTree之类的普通表引擎时，通常是异步写入，但在使用表函数时（使用owned_cluster来判断是否是表函数），通常会使用同步写入。这也是在设计业务逻辑时需要注意的

据京东云的文章说，线上会有异步写入的情况，这个是为啥，是完全当成一个单机表来用的？
其次表函数是个啥？
可以确认下同步异步写的更多关键字

## 事务支持


# 查询

## 稀疏索引
