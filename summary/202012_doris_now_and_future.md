# 现有问题(主要是美团内部遇到的问题)
  
## 1 查询稳定性
* 当有大量大查询到来时，整个集群都处于查询不可用的状态，即使是小查询也无法处结果
* 期望的目标是，当很多大查询到来的时候，小查询也可以正常执行
* 大查询的特征是什么？
    * 住宿集群，查询的时间范围比较大，其他问题未知
    * 外卖集群，主要是shuffle的的负载比较高
        * scan的线程数很多的话，也会有比较长时间的等待的问题
        * 进程内做到查询隔离并不是一个靠谱的方案
        * 研究方向是进程内各个数据结构的共享时可以进行优先级的处理，这个感觉就太大了
    * 现阶段可以做的事
        * 实时感知，实时告警与运维
             * 可以加一个实时感知的基于cpu时间的tp99监控
	     * 这包括单纯的查询，doris2doris，stream load，并且在es中可以快速检索到这样的查询
			
## 2 集群拆分过多
* 拆这么多的原因依然是因为隔离性比较差
## 3 实时场景的支持
* kafka2doris，compaction吧
        * 目前线上暂时还没发现由于compaction导致的查询问题
        * 但是毫无疑问的是，越实时的场景，compaction压力越大，如果能做到读写分离的话
        * doris2doris，查询间相互影响;其实doris2doris本身应该是分钟级的实时性，还无法做到秒级的实时
            * doris需要做到秒级的实时吗 

## 4 读写之间的相互影响
## 5 其他扩展类的，只能是每周看工单总结

# 需求与业务场景分析
* 1 美团这种体量的公司的业务需求的演变
    * 单纯的olap分析场景逐渐演变成实时的数据分析与ETL
    * 关于实时
        * 实时场景是必需的吗？
              * 从业务的需求变化来说是的，最初doris只有hive2doris，但是后来有了kafka2doris以及doris2doris
                     * 可以参考下朱良的那篇美团的实时数仓
                     * 那么为什么会有实时场景的需求呢？
    * 关于ETL
             * 为什么会有实时的ETL的需求呢？
                    * 应该是还是归属于实时场景需求的问题，弄明白第一个就可以解决这个一个了

* 2 其他规模较小的公司
    * one engine do all
        * hadoop的运维使用与运维过重，如果能有一个引擎搞定数仓生产和分析，而且是开源的，那么是最佳的
            * 这个其实是个很大的卖点，但是美团这类公司内部是没有这个问题的
            * 是解决美团内部的问题价值更大，还是解决大部分中小企业的价值更大

* 3 其他的暂时没想到的，只能是看业界的文章与动态

## 设计思路与业务场景是否有变化
	最初的需求应该是只想搞一个报表分析的，但是业务需求演变成了可以带一定的生产与实时分析的场景
	设计目标的话，可以去看最初的baidu palo的分享文章

## 后续可以做的事
* 1 已有场景的调研
    * 实时场景的需求调研(先搞这个吧)
        * 实时的数据分析
        * 实时的etl
        * 实时精确去重
    * 实时场景的技术调研
        * design streaming system（流式一定是实时的吗）
        * druid设计
        * flink设计

* 2 新的方向的场景调研
    * 资源隔离
        * 基于C++实现的CGroup，我怎么感觉这个方向涉及容器编排啥的乱七八糟的
        * 查询是不是可以基于实例粒度的部署呢？
            * 一个实例只负责读取文件的接口
            * 另一个实例负责计算
            * 假定C++支持进程内的资源隔离，那其实也就简单了
            * 代码中的cgroup可以研究下到底有没有用
    * 存储计算分离(存储共享，计算隔离)
            * 如果doris目前要搞这个，需要调研哪些技术，做哪些改造
            * 现有系统的实现是怎样的呢？
            * 基于对象的存储

* 3 每周总结
    * 业务需求总结
        * 看下业务的需求工单，找出其中真正有价值的问题
    * 个人总结

* 4 和社区同学多多沟通，反馈想法

* 5 每日需求与问题总结

* 6 总结完成之后可以从需求与技术的角度，输出一篇文章

* 7 参考其他引擎的最新设计
        * snowflake
        * greenplum
        * adb
        * kylin
* 8 其他公司的分享
    * 快手
    * 头条
    * 小米 

* 其他联想的问题
	目前云上的doris，弹性是如何做的？